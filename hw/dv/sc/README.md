## SystemC DV (SCDV) Guide

This document summarizes the SystemC/UVM-SystemC DV flow for OpenTitan IPs: generation, exclusions, RAL prediction rules, common sequences, coverage, and reporting.

### Prerequisites
- Python venv: use `./.venv/bin/python` consistently.
- Environment:
  - `SYSTEMC_HOME` and `UVM_SYSTEMC_HOME` must point to your installs.

### Collateral Generation
Generate SC DV collateral from HJSON:
```
./.venv/bin/python util/gen_scdv_collateral.py <ip>
```
Key artifacts per IP under `hw/ip/<ip>/scdv/`:
- `reg/` SystemC RAL (generated by regtool templates)
- `env/` UVM-SC env glue
- `seq_lib/` common sequences
- `tests/` tests and Makefile

### CSR Exclusions (SV parity)
`util/uvmdvgen/gen_sc.py` derives default exclusions from HJSON (e.g., WO-only, reserved, shadow-phase, REGWEN-gated) and emits `csr_exclude.hpp`. Exclusions are initialized in test `main.cpp` via `scdv::init_default_exclusions()` and can be overridden per IP.

### RAL Prediction Rules (byte-enable aware)
Regmodel templates mirror SV semantics:
- Writes honor `wmask` and TL byte enables (PutPartialData).
- Access types respected: RW/RO/WO/W1C/R0W1C/RW1S/RC, SHADOW 2-phase, REGWEN gating.
- Scoreboard reads expected via `tl_bind::ral_sw_read` and masked compare.

### Common Sequences and Tests
Autogenerated simple sequences/tests per IP:
- `*_w1c`, `*_wo_rc`, `*_shadow`, `*_regwen`, `*_racl`, `*_tlul_err`, `*_window`
- `*_csr_addr_sweep`: deduped addr sweep + illegal addr sampling (min/max/random)
- `*_tl_partial`: 1B/2B/4B PutPartialData with mask patterns

Run example (UART):
```
make -C hw/ip/uart/scdv/tests -j1 uart_csr_addr_sweep_test
hw/ip/uart/scdv/tests/uart_csr_addr_sweep_test +ntb_random_seed=random
```

### Functional Coverage (FC4SC)
`hw/dv/sc/coverage/csr_cov.hpp` provides common CSR coverage, registered from `gen_sc.py`:
- Categories: `intr`, `alert`, `rc`, `shadow`, `regwen` auto-registered based on HJSON
- Address coverpoint: auto bins per CSR name + `others`
- Mask-class bins and `rw_cat_mask_cross`
`tl_monitor.hpp` samples coverage on bus activity; illegal unknown addresses map to `0xFFFFFFFFu` for `addr_cp.others`.

### Coverage Report
Generate and merge per IP:
```
./.venv/bin/python util/scdv_cov_report.py --ip <ip> \
  --outdir hw/ip/<ip>/scdv/tests/coverage_html --systemc-home "$SYSTEMC_HOME" \
  --tests "<optional test list>" --jobs 1 --repeat 1 --timeout 600
```
The tool renders all covergroups/points/bins/crosses automatically and applies N/A rules from `coverage_manifest.json` (generated by `gen_sc.py`).

### CI Hooks (suggested)
- Regeneration no-diff check
- Build and selected tests (fast path), nightly all-IP
- Upload merged JSON and HTML artifacts

### Troubleshooting
- If coverage HTML misses `addr_cp`, ensure `CSR_ADDR_BINS_DEF` is defined before including `csr_cov.hpp` (handled by generator).
- If `others` is 0, run `*_tlul_err_test` or `*_csr_addr_sweep_test` which perform explicit illegal reads.

SystemC/UVM-SC counterparts of hw/dv/sv components. Skeleton directories mirror sv layout.

Usage (per IP tests under hw/ip/<ip>/scdv/tests):
- Build: ensure SYSTEMC_HOME and UVM_SYSTEMC_HOME, then `make all`
- Run: `./<ip>_smoke_test +UVM_TESTNAME=<ip>_smoke_test +UVM_VERBOSITY=UVM_MEDIUM +ntb_random_seed=random`

Flags:
- +UVM_TESTNAME=<test_class>
- +UVM_VERBOSITY=UVM_NONE|UVM_LOW|UVM_MEDIUM|UVM_HIGH|UVM_FULL
- +UVM_TIMEOUT=<value>[ns|us|ms|s]
- +ntb_random_seed=<N>|random

Template verification:
- `util/sc_tlm_diff.py --ip <ip>` to regen TLM and diff vs checked-in.
